<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CareerPilot - Upload Resume</title>
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect" />
    <link
      as="style"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter:wght@400;500;700;900"
      onload="this.rel='stylesheet'"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <script>
        function redirectToDevicePage() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                window.location.href = 'resumemobile.html';
            } 
        }
        
        // Redirect on page load
        window.onload = redirectToDevicePage;
    </script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#1919e6",
              "background-light": "#f6f6f8",
              "background-dark": "#111121",
            },
            fontFamily: {
              display: ["Inter"],
            },
            borderRadius: {
              DEFAULT: "0.5rem",
              lg: "1rem",
              xl: "1.5rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200"
  >
    <div class="flex flex-col min-h-screen">
      <!-- Header -->
      <header class="border-b border-gray-200 dark:border-gray-700/50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex h-16 items-center justify-between">
            <div class="flex items-center gap-4">
              <svg
                class="h-8 w-8 text-primary"
                fill="none"
                viewBox="0 0 48 48"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  clip-rule="evenodd"
                  d="M39.475 21.6262C40.358 21.4363 40.6863 21.5589 40.7581 21.5934C40.7876 21.655 40.8547 21.857 40.8082 22.3336C40.7408 23.0255 40.4502 24.0046 39.8572 25.2301C38.6799 27.6631 36.5085 30.6631 33.5858 33.5858C30.6631 36.5085 27.6632 38.6799 25.2301 39.8572C24.0046 40.4502 23.0255 40.7407 22.3336 40.8082C21.8571 40.8547 21.6551 40.7875 21.5934 40.7581C21.5589 40.6863 21.4363 40.358 21.6262 39.475C21.8562 38.4054 22.4689 36.9657 23.5038 35.2817C24.7575 33.2417 26.5497 30.9744 28.7621 28.762C30.9744 26.5497 33.2417 24.7574 35.2817 23.5037C36.9657 22.4689 38.4054 21.8562 39.475 21.6262ZM4.41189 29.2403L18.7597 43.5881C19.8813 44.7097 21.4027 44.9179 22.7217 44.7893C24.0585 44.659 25.5148 44.1631 26.9723 43.4579C29.9052 42.0387 33.2618 39.5667 36.4142 36.4142C39.5667 33.2618 42.0387 29.9052 43.4579 26.9723C44.1631 25.5148 44.659 24.0585 44.7893 22.7217C44.9179 21.4027 44.7097 19.8813 43.5881 18.7597L29.2403 4.41187C27.8527 3.02428 25.8765 3.02573 24.2861 3.36776C22.6081 3.72863 20.7334 4.58419 18.8396 5.74801C16.4978 7.18716 13.9881 9.18353 11.5858 11.5858C9.18354 13.988 7.18717 16.4978 5.74802 18.8396C4.58421 20.7334 3.72865 22.6081 3.36778 24.2861C3.02574 25.8765 3.02429 27.8527 4.41189 29.2403Z"
                  fill="currentColor"
                  fill-rule="evenodd"
                ></path>
              </svg>
              <h1 class="text-xl font-bold text-gray-900 dark:text-white">
                CareerPilot
              </h1>
            </div>
            <nav class="hidden md:flex items-center gap-8">
              <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors" href="#">Dashboard</a>
              <a class="text-sm font-medium text-primary dark:text-primary" href="#">Resume</a>
              <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors" href="#">Cover Letter</a>
              <a class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors" href="#">Portfolio</a>
            </nav>
            <div class="flex items-center gap-4">
              <button class="bg-primary text-white font-bold text-sm px-4 py-2 rounded-lg hover:opacity-90 transition-opacity">
                Upgrade
              </button>
              <button id="logoutBtn" class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-red-500 transition-colors">
                Logout
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="max-w-3xl mx-auto">
          <div class="text-center mb-8">
            <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
              Upload Your Resume
            </h2>
            <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">
              Let our AI assistant help you land your dream job.
            </p>
          </div>

          <!-- Existing Resume Display -->
          <div id="existingResume" class="mb-8 hidden">
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-4">
                  <span class="material-symbols-outlined text-2xl text-blue-600">description</span>
                  <div>
                    <h3 class="font-semibold text-blue-900 dark:text-blue-100" id="existingFileName">Current Resume</h3>
                    <p class="text-sm text-blue-600 dark:text-blue-300" id="existingFileInfo">Uploaded on Date</p>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button id="viewExtractedDataBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                    View Data
                  </button>
                  <button id="deleteResumeBtn" class="text-red-600 hover:text-red-800 transition-colors">
                    <span class="material-symbols-outlined">delete</span>
                  </button>
                </div>
              </div>
              
              <!-- Extracted Data Display -->
              <div id="extractedDataDisplay" class="hidden mt-4 border-t border-blue-200 dark:border-blue-700 pt-4">
                <h4 class="font-semibold text-blue-900 dark:text-blue-100 mb-4 flex items-center gap-2">
                  <span class="material-symbols-outlined">analytics</span>
                  Extracted Information & AI Analysis
                </h4>
                
                <!-- AI Generated Summary -->
                <div id="aiSummarySection" class="mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-700">
                  <h5 class="font-medium text-blue-800 dark:text-blue-200 mb-2 flex items-center gap-2">
                    <span class="material-symbols-outlined text-sm">auto_awesome</span>
                    AI-Generated Professional Summary
                  </h5>
                  <p id="generatedSummary" class="text-blue-700 dark:text-blue-300 text-sm leading-relaxed italic">
                    No summary generated yet...
                  </p>
                </div>

                <!-- Original Summary (if found) -->
                <div id="originalSummarySection" class="mb-4 hidden">
                  <h5 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Original Resume Summary</h5>
                  <p id="extractedSummary" class="text-blue-700 dark:text-blue-300 text-sm bg-blue-50 dark:bg-blue-900/10 p-3 rounded border">
                    -
                  </p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 text-sm">
                  <!-- Personal Information -->
                  <div id="personalInfo" class="space-y-3">
                    <h5 class="font-medium text-blue-800 dark:text-blue-200 flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm">person</span>
                      Personal Information
                    </h5>
                    <div class="space-y-2 text-blue-700 dark:text-blue-300">
                      <div class="flex justify-between">
                        <strong>Name:</strong> <span id="extractedName" class="text-right">-</span>
                      </div>
                      <div class="flex justify-between">
                        <strong>Email:</strong> <span id="extractedEmail" class="text-right">-</span>
                      </div>
                      <div class="flex justify-between">
                        <strong>Phone:</strong> <span id="extractedPhone" class="text-right">-</span>
                      </div>
                      <div class="flex justify-between">
                        <strong>Location:</strong> <span id="extractedLocation" class="text-right">-</span>
                      </div>
                    </div>
                    
                    <!-- URLs Section -->
                    <div id="urlsSection" class="pt-2 border-t border-blue-200 dark:border-blue-600">
                      <h6 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Online Presence</h6>
                      <div class="space-y-1 text-xs">
                        <div id="linkedinDiv" class="hidden">
                          <strong>LinkedIn:</strong> <a id="extractedLinkedin" href="#" target="_blank" class="text-blue-600 hover:underline">-</a>
                        </div>
                        <div id="githubDiv" class="hidden">
                          <strong>GitHub:</strong> <a id="extractedGithub" href="#" target="_blank" class="text-blue-600 hover:underline">-</a>
                        </div>
                        <div id="portfolioDiv" class="hidden">
                          <strong>Portfolio:</strong> <a id="extractedPortfolio" href="#" target="_blank" class="text-blue-600 hover:underline">-</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Professional Information -->
                  <div id="professionalInfo" class="space-y-3">
                    <h5 class="font-medium text-blue-800 dark:text-blue-200 flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm">work</span>
                      Professional Experience
                    </h5>
                    <div class="space-y-2 text-blue-700 dark:text-blue-300">
                      <div class="flex justify-between">
                        <strong>Current Role:</strong> <span id="extractedCurrentRole" class="text-right">-</span>
                      </div>
                      <div class="flex justify-between">
                        <strong>Years Experience:</strong> <span id="extractedYearsExp" class="text-right">-</span>
                      </div>
                      <div>
                        <strong>Companies:</strong>
                        <div id="extractedCompanies" class="mt-1 text-xs">-</div>
                      </div>
                      <div>
                        <strong>Industries:</strong>
                        <div id="extractedIndustries" class="mt-1 text-xs">-</div>
                      </div>
                    </div>
                    
                    <!-- Education Section -->
                    <div class="pt-2 border-t border-blue-200 dark:border-blue-600">
                      <h6 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Education</h6>
                      <div id="extractedEducation" class="text-xs">-</div>
                    </div>
                  </div>
                  
                  <!-- Skills & Expertise -->
                  <div id="skillsInfo" class="space-y-3">
                    <h5 class="font-medium text-blue-800 dark:text-blue-200 flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm">psychology</span>
                      Skills & Expertise
                    </h5>
                    
                    <!-- Technical Skills -->
                    <div class="space-y-2">
                      <h6 class="font-medium text-blue-800 dark:text-blue-200 text-xs">Technical Skills</h6>
                      <div id="extractedSkills" class="flex flex-wrap gap-1">
                        <!-- Skills will be populated as badges -->
                      </div>
                    </div>
                    
                    <!-- Soft Skills -->
                    <div class="space-y-2">
                      <h6 class="font-medium text-blue-800 dark:text-blue-200 text-xs">Soft Skills</h6>
                      <div id="extractedSoftSkills" class="flex flex-wrap gap-1">
                        <!-- Soft skills will be populated as badges -->
                      </div>
                    </div>
                    
                    <!-- Languages -->
                    <div class="space-y-2">
                      <h6 class="font-medium text-blue-800 dark:text-blue-200 text-xs">Languages</h6>
                      <div id="extractedLanguages" class="text-xs">-</div>
                    </div>
                    
                    <!-- Certifications -->
                    <div class="space-y-2">
                      <h6 class="font-medium text-blue-800 dark:text-blue-200 text-xs">Certifications</h6>
                      <div id="extractedCertifications" class="text-xs">-</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Upload Section -->
          <div class="bg-white dark:bg-gray-800/50 rounded-xl shadow-sm">
            <div class="p-8">
              <form id="resumeUploadForm" enctype="multipart/form-data">
                <div class="flex justify-center items-center w-full">
                  <label
                    class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700/80 transition-colors"
                    for="resumeFile"
                    id="dropZone"
                  >
                    <div class="flex flex-col items-center justify-center pt-5 pb-6" id="uploadContent">
                      <span class="material-symbols-outlined text-6xl text-gray-400 dark:text-gray-500">upload_file</span>
                      <p class="mb-2 text-lg font-bold text-gray-700 dark:text-gray-300">
                        <span class="font-semibold text-primary">Click to upload</span>
                        or drag and drop
                      </p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">
                        PDF, DOC, DOCX (MAX. 10MB)
                      </p>
                    </div>
                    <input class="hidden" id="resumeFile" name="resume" type="file" accept=".pdf,.doc,.docx" />
                  </label>
                </div>
              </form>
            </div>

            <!-- Progress Section -->
            <div class="px-8 pb-8 hidden" id="progressSection">
              <div class="space-y-4">
                <p class="text-sm font-medium text-gray-700 dark:text-gray-300" id="progressText">
                  Uploading your_resume.pdf
                </p>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                  <div class="bg-primary h-2.5 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-sm text-gray-500 dark:text-gray-400">
                  <span id="progressStatus">Preparing upload...</span>
                  <span id="progressPercent">0% complete</span>
                </div>
              </div>
            </div>

            <!-- Processing Section -->
            <div class="px-8 pb-8 hidden" id="processingSection">
              <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
                <div class="flex items-center gap-3">
                  <div class="animate-spin h-5 w-5 border-2 border-yellow-500 border-t-transparent rounded-full"></div>
                  <div>
                    <p class="font-semibold text-yellow-800 dark:text-yellow-200">Processing your resume...</p>
                    <p class="text-sm text-yellow-600 dark:text-yellow-300">Extracting text and analyzing content</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Success Section -->
            <div class="px-8 pb-8 hidden" id="successSection">
              <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                <div class="flex items-center gap-3">
                  <span class="material-symbols-outlined text-green-600">check_circle</span>
                  <div>
                    <p class="font-semibold text-green-800 dark:text-green-200">Resume uploaded successfully!</p>
                    <p class="text-sm text-green-600 dark:text-green-300">Your resume has been processed and is ready for job matching</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const API_BASE_URL = 'http://localhost:4000/api';
      let currentFile = null;

      // Check authentication
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/public/auth/login.html';
      }

      // Load existing resume on page load
      document.addEventListener('DOMContentLoaded', loadExistingResume);

      // File upload handling
      const resumeFile = document.getElementById('resumeFile');
      const dropZone = document.getElementById('dropZone');
      const progressSection = document.getElementById('progressSection');
      const processingSection = document.getElementById('processingSection');
      const successSection = document.getElementById('successSection');

      // File input change event
      resumeFile.addEventListener('change', handleFileSelect);

      // Drag and drop events
      dropZone.addEventListener('dragover', handleDragOver);
      dropZone.addEventListener('drop', handleDrop);

      // Logout functionality
      document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = '/public/auth/login.html';
      });

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          validateAndUploadFile(file);
        }
      }

      function handleDragOver(e) {
        e.preventDefault();
        dropZone.classList.add('border-primary');
      }

      function handleDrop(e) {
        e.preventDefault();
        dropZone.classList.remove('border-primary');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          validateAndUploadFile(files[0]);
        }
      }

      function validateAndUploadFile(file) {
        // Validate file type
        const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
        if (!allowedTypes.includes(file.type)) {
          alert('Please upload a PDF, DOC, or DOCX file.');
          return;
        }

        // Validate file size (10MB)
        if (file.size > 10 * 1024 * 1024) {
          alert('File size must be less than 10MB.');
          return;
        }

        currentFile = file;
        uploadFile(file);
      }

      async function uploadFile(file) {
        const formData = new FormData();
        formData.append('resume', file);

        // Show progress section
        progressSection.classList.remove('hidden');
        document.getElementById('progressText').textContent = `Uploading ${file.name}`;

        try {
          const xhr = new XMLHttpRequest();
          
          // Progress tracking
          xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
              const percentComplete = (e.loaded / e.total) * 100;
              updateProgress(percentComplete, 'Uploading...');
            }
          });

          xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
              const response = JSON.parse(xhr.responseText);
              updateProgress(100, 'Upload complete!');
              
              // Show processing section
              setTimeout(() => {
                progressSection.classList.add('hidden');
                processingSection.classList.remove('hidden');
                
                // Check processing status
                checkProcessingStatus();
              }, 1000);
            } else {
              const error = JSON.parse(xhr.responseText);
              throw new Error(error.msg || 'Upload failed');
            }
          });

          xhr.addEventListener('error', () => {
            throw new Error('Network error during upload');
          });

          xhr.open('POST', `${API_BASE_URL}/resume/upload`);
          xhr.setRequestHeader('Authorization', `Bearer ${token}`);
          xhr.send(formData);

        } catch (error) {
          console.error('Upload error:', error);
          alert('Upload failed: ' + error.message);
          resetUploadState();
        }
      }

      function updateProgress(percent, status) {
        document.getElementById('progressBar').style.width = `${percent}%`;
        document.getElementById('progressPercent').textContent = `${Math.round(percent)}% complete`;
        document.getElementById('progressStatus').textContent = status;
      }

      async function checkProcessingStatus() {
        try {
          const response = await fetch(`${API_BASE_URL}/resume`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (response.ok) {
            const data = await response.json();
            
            if (data.resume.isProcessed) {
              // Show success
              processingSection.classList.add('hidden');
              successSection.classList.remove('hidden');
              
              // Reload existing resume
              setTimeout(() => {
                loadExistingResume();
                resetUploadState();
              }, 2000);
            } else {
              // Still processing, check again
              setTimeout(checkProcessingStatus, 2000);
            }
          }
        } catch (error) {
          console.error('Error checking processing status:', error);
        }
      }

      async function loadExistingResume() {
        try {
          const response = await fetch(`${API_BASE_URL}/resume`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });

          if (response.ok) {
            const data = await response.json();
            showExistingResume(data.resume);
          }
        } catch (error) {
          console.log('No existing resume found');
        }
      }

      function showExistingResume(resume) {
        const existingResumeDiv = document.getElementById('existingResume');
        const fileName = document.getElementById('existingFileName');
        const fileInfo = document.getElementById('existingFileInfo');

        fileName.textContent = resume.filename;
        fileInfo.textContent = `Uploaded on ${new Date(resume.uploadedAt).toLocaleDateString()}`;
        
        existingResumeDiv.classList.remove('hidden');

        // Populate extracted data
        populateExtractedData(resume.extractedData || {});

        // View extracted data functionality
        document.getElementById('viewExtractedDataBtn').addEventListener('click', toggleExtractedData);

        // Delete resume functionality
        document.getElementById('deleteResumeBtn').addEventListener('click', deleteResume);
      }

      function populateExtractedData(data) {
        console.log('Populating extracted data:', data);
        
        // AI Generated Summary
        if (data.generatedSummary) {
          document.getElementById('generatedSummary').textContent = data.generatedSummary;
          document.getElementById('generatedSummary').classList.remove('italic');
        }
        
        // Original Summary (show if different from generated)
        if (data.summary && data.summary.length > 50) {
          document.getElementById('extractedSummary').textContent = data.summary;
          document.getElementById('originalSummarySection').classList.remove('hidden');
        }

        // Personal Information
        document.getElementById('extractedName').textContent = data.name || '-';
        document.getElementById('extractedEmail').textContent = data.email || '-';
        document.getElementById('extractedPhone').textContent = data.phone || '-';
        document.getElementById('extractedLocation').textContent = data.location || '-';

        // URLs with proper links
        if (data.linkedinUrl) {
          document.getElementById('extractedLinkedin').href = data.linkedinUrl.startsWith('http') ? data.linkedinUrl : 'https://' + data.linkedinUrl;
          document.getElementById('extractedLinkedin').textContent = 'View Profile';
          document.getElementById('linkedinDiv').classList.remove('hidden');
        }
        if (data.githubUrl) {
          document.getElementById('extractedGithub').href = data.githubUrl.startsWith('http') ? data.githubUrl : 'https://' + data.githubUrl;
          document.getElementById('extractedGithub').textContent = 'View Repository';
          document.getElementById('githubDiv').classList.remove('hidden');
        }
        if (data.portfolioUrl) {
          document.getElementById('extractedPortfolio').href = data.portfolioUrl.startsWith('http') ? data.portfolioUrl : 'https://' + data.portfolioUrl;
          document.getElementById('extractedPortfolio').textContent = 'View Portfolio';
          document.getElementById('portfolioDiv').classList.remove('hidden');
        }

        // Professional Information
        document.getElementById('extractedCurrentRole').textContent = data.currentJobTitle || (data.jobTitles && data.jobTitles.length > 0 ? data.jobTitles[0] : '-');
        document.getElementById('extractedYearsExp').textContent = data.yearsOfExperience ? data.yearsOfExperience + '+ years' : '-';
        
        // Companies as badges
        const companiesDiv = document.getElementById('extractedCompanies');
        if (data.companies && data.companies.length > 0) {
          companiesDiv.innerHTML = data.companies.slice(0, 3).map(company => 
            `<span class="inline-block bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-1 rounded text-xs mr-1 mb-1">${company}</span>`
          ).join('');
        } else {
          companiesDiv.textContent = '-';
        }
        
        // Industries
        const industriesDiv = document.getElementById('extractedIndustries');
        if (data.industryExperience && data.industryExperience.length > 0) {
          industriesDiv.innerHTML = data.industryExperience.map(industry => 
            `<span class="inline-block bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 px-2 py-1 rounded text-xs mr-1 mb-1">${industry}</span>`
          ).join('');
        } else {
          industriesDiv.textContent = '-';
        }

        // Education
        const educationDiv = document.getElementById('extractedEducation');
        if (data.education && data.education.length > 0) {
          const educationList = data.education.map(edu => {
            if (typeof edu === 'object') {
              return `${edu.degree || ''} ${edu.field ? 'in ' + edu.field : ''} ${edu.institution ? 'from ' + edu.institution : ''}`.trim();
            }
            return edu;
          }).filter(edu => edu && edu.length > 0);
          
          educationDiv.innerHTML = educationList.slice(0, 3).map(edu => 
            `<div class="mb-1 p-2 bg-purple-50 dark:bg-purple-900/20 rounded border border-purple-200 dark:border-purple-700">${edu}</div>`
          ).join('');
        } else {
          educationDiv.textContent = '-';
        }

        // Technical Skills as colorful badges
        const skillsDiv = document.getElementById('extractedSkills');
        if (data.skills && data.skills.length > 0) {
          const skillColors = ['bg-red-100 text-red-800', 'bg-blue-100 text-blue-800', 'bg-green-100 text-green-800', 'bg-yellow-100 text-yellow-800', 'bg-purple-100 text-purple-800', 'bg-indigo-100 text-indigo-800'];
          skillsDiv.innerHTML = data.skills.slice(0, 15).map((skill, index) => 
            `<span class="inline-block ${skillColors[index % skillColors.length]} dark:bg-opacity-20 px-2 py-1 rounded text-xs mr-1 mb-1">${skill}</span>`
          ).join('');
        } else {
          skillsDiv.innerHTML = '<span class="text-gray-500">-</span>';
        }

        // Soft Skills as badges
        const softSkillsDiv = document.getElementById('extractedSoftSkills');
        if (data.softSkills && data.softSkills.length > 0) {
          softSkillsDiv.innerHTML = data.softSkills.slice(0, 8).map(skill => 
            `<span class="inline-block bg-orange-100 dark:bg-orange-800 text-orange-800 dark:text-orange-200 px-2 py-1 rounded text-xs mr-1 mb-1">${skill}</span>`
          ).join('');
        } else {
          softSkillsDiv.innerHTML = '<span class="text-gray-500">-</span>';
        }

        // Languages
        document.getElementById('extractedLanguages').textContent = 
          (data.languages && data.languages.length > 0) ? data.languages.join(', ') : '-';

        // Certifications
        const certificationsDiv = document.getElementById('extractedCertifications');
        if (data.certifications && data.certifications.length > 0) {
          certificationsDiv.innerHTML = data.certifications.slice(0, 5).map(cert => 
            `<div class="mb-1 p-1 bg-teal-50 dark:bg-teal-900/20 rounded border border-teal-200 dark:border-teal-700 text-xs">${cert}</div>`
          ).join('');
        } else {
          certificationsDiv.textContent = '-';
        }
      }

      function toggleExtractedData() {
        const display = document.getElementById('extractedDataDisplay');
        const btn = document.getElementById('viewExtractedDataBtn');
        
        if (display.classList.contains('hidden')) {
          display.classList.remove('hidden');
          btn.textContent = 'Hide Data';
        } else {
          display.classList.add('hidden');
          btn.textContent = 'View Data';
        }
      }

      async function deleteResume() {
        if (confirm('Are you sure you want to delete your resume?')) {
          try {
            const response = await fetch(`${API_BASE_URL}/resume`, {
              method: 'DELETE',
              headers: {
                'Authorization': `Bearer ${token}`
              }
            });

            if (response.ok) {
              document.getElementById('existingResume').classList.add('hidden');
              alert('Resume deleted successfully');
            }
          } catch (error) {
            console.error('Error deleting resume:', error);
            alert('Error deleting resume');
          }
        }
      }

      function resetUploadState() {
        progressSection.classList.add('hidden');
        processingSection.classList.add('hidden');
        successSection.classList.add('hidden');
        resumeFile.value = '';
        currentFile = null;
      }
    </script>
  </body>
</html>